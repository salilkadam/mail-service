apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: email-server
  namespace: email-server-prod

resources:
  - namespace.yaml
  - postfix-relay-deployment.yaml
  - postfix-relay-service.yaml
  - network-policy.yaml
  - configmap.yaml

commonLabels:
  app.kubernetes.io/name: email-server
  app.kubernetes.io/version: 1.0.0
  app.kubernetes.io/component: infrastructure
  app.kubernetes.io/part-of: mail-service

images:
  - name: juanluisbaptiste/postfix
    newTag: latest

patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: postfix-relay
      namespace: email-server-prod
    spec:
      template:
        spec:
          containers:
          - name: postfix
            env:
            - name: maildomain
              value: "bionicaisolutions.com"
            - name: relayhost
              value: "[smtp-relay.gmail.com]:587"
            - name: ALLOWED_SENDER_DOMAINS
              value: "bionicaisolutions.com,gmail.com"
            - name: SMTP_SERVER
              value: "smtp-relay.gmail.com"
            - name: SMTP_PORT
              value: "587"
            - name: SERVER_HOSTNAME
              value: "mail.bionicaisolutions.com"
